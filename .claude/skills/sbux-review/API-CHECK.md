# API ä¸€è‡´æ€§æ£€æŸ¥è§„èŒƒ

æœ¬æ–‡æ¡£å®šä¹‰ API ä¸€è‡´æ€§æ£€æŸ¥çš„è§„åˆ™å’Œæ‰§è¡Œæ–¹æ³•ã€‚

---

## æ£€æŸ¥ç›®æ ‡

éªŒè¯ API å®ç°æ˜¯å¦ä¸ `3-api-spec.md` ä¸­å®šä¹‰çš„æ¥å£è§„æ ¼ä¸€è‡´ã€‚

---

## è¾“å…¥æ¥æº

### 3-api-spec.md ç»“æ„

éœ€è¦æå–çš„ API è§„æ ¼ï¼š

1. **æ¥å£åŸºæœ¬ä¿¡æ¯**
   - HTTP æ–¹æ³•ï¼ˆGET, POST, PUT, DELETE ç­‰ï¼‰
   - è¯·æ±‚è·¯å¾„ï¼ˆå¦‚ `/api/users/{id}`ï¼‰
   - æ¥å£æè¿°

2. **è¯·æ±‚å‚æ•°**
   - è·¯å¾„å‚æ•°ï¼ˆPath Parametersï¼‰
   - æŸ¥è¯¢å‚æ•°ï¼ˆQuery Parametersï¼‰
   - è¯·æ±‚ä½“ï¼ˆRequest Bodyï¼‰
   - å¿…å¡«/å¯é€‰æ ‡è¯†

3. **å“åº”å®šä¹‰**
   - æˆåŠŸå“åº”æ ¼å¼
   - é”™è¯¯å“åº”æ ¼å¼
   - HTTP çŠ¶æ€ç 

4. **é”™è¯¯ç **
   - ä¸šåŠ¡é”™è¯¯ç 
   - é”™è¯¯æ¶ˆæ¯

**ç¤ºä¾‹ API è§„æ ¼**ï¼š
```markdown
### POST /api/users

åˆ›å»ºæ–°ç”¨æˆ·

#### è¯·æ±‚ä½“

| å­—æ®µ | ç±»å‹ | å¿…å¡« | è¯´æ˜ |
|------|------|------|------|
| email | string | æ˜¯ | ç”¨æˆ·é‚®ç®± |
| password | string | æ˜¯ | å¯†ç ï¼Œè‡³å°‘8ä½ |
| name | string | å¦ | ç”¨æˆ·å |

#### å“åº”

æˆåŠŸï¼ˆ201ï¼‰ï¼š
```json
{
  "id": 1,
  "email": "user@example.com",
  "name": "å¼ ä¸‰"
}
```

é”™è¯¯ï¼ˆ400ï¼‰ï¼š
```json
{
  "code": "INVALID_EMAIL",
  "message": "é‚®ç®±æ ¼å¼æ— æ•ˆ"
}
```
```

### å®ç°ä»£ç 

æ‰«æçš„ä»£ç ä½ç½®ï¼š
- Java: `*Controller.java`, `*Resource.java`
- TypeScript/JavaScript: `*Controller.ts`, `*Router.ts`, `routes/*.ts`
- Python: `*_api.py`, `routes/*.py`, `views/*.py`
- Go: `*_handler.go`, `*_controller.go`

---

## API è§„æ ¼æå–

### æ­¥éª¤ 1ï¼šè§£æ API æ–‡æ¡£

ä» Markdown æ–‡æ¡£æå– API å®šä¹‰ï¼š

```
apis:
  - method: POST
    path: /api/users
    request:
      body:
        - {name: email, type: string, required: true}
        - {name: password, type: string, required: true}
        - {name: name, type: string, required: false}
    responses:
      - {status: 201, type: object}
      - {status: 400, code: INVALID_EMAIL}
```

### æ­¥éª¤ 2ï¼šè§£æå®ç°ä»£ç 

ä»ä»£ç æå– API å®šä¹‰ï¼š

**Java (Spring)**ï¼š
```java
@PostMapping("/api/users")
public ResponseEntity<UserDTO> createUser(@RequestBody CreateUserRequest request) {
    // æå–: POST /api/users
    // è¯·æ±‚ä½“: CreateUserRequest
}
```

**TypeScript (Express/NestJS)**ï¼š
```typescript
@Post('/api/users')
async createUser(@Body() request: CreateUserDto): Promise<UserDto> {
    // æå–: POST /api/users
    // è¯·æ±‚ä½“: CreateUserDto
}
```

---

## æ£€æŸ¥è§„åˆ™

### 1. è·¯å¾„ä¸€è‡´æ€§

**è§„åˆ™**ï¼šå®ç°çš„ API è·¯å¾„ä¸è§„æ ¼ä¸€è‡´

**æ£€æŸ¥ç‚¹**ï¼š
- åŸºç¡€è·¯å¾„åŒ¹é…
- è·¯å¾„å‚æ•°å ä½ç¬¦åŒ¹é…ï¼ˆ`:id` vs `{id}`ï¼‰
- ç‰ˆæœ¬å‰ç¼€ä¸€è‡´

| è§„æ ¼ | å®ç° | ç»“æœ |
|------|------|------|
| `/api/users/{id}` | `/api/users/{id}` | âœ… |
| `/api/users/{id}` | `/api/users/:id` | âœ… (ç­‰ä»·) |
| `/api/users/{id}` | `/users/{id}` | âŒ ç¼ºå°‘ /api å‰ç¼€ |

### 2. æ–¹æ³•ä¸€è‡´æ€§

**è§„åˆ™**ï¼šHTTP æ–¹æ³•ä¸è§„æ ¼ä¸€è‡´

**æ£€æŸ¥ç‚¹**ï¼š
- GET, POST, PUT, PATCH, DELETE åŒ¹é…

| è§„æ ¼ | å®ç° | ç»“æœ |
|------|------|------|
| POST /api/users | POST /api/users | âœ… |
| POST /api/users | PUT /api/users | âŒ æ–¹æ³•ä¸åŒ¹é… |

### 3. è¯·æ±‚å‚æ•°ä¸€è‡´æ€§

**è§„åˆ™**ï¼šè¯·æ±‚å‚æ•°å®Œæ•´ä¸”ç±»å‹æ­£ç¡®

**æ£€æŸ¥ç‚¹**ï¼š

| æ£€æŸ¥é¡¹ | è§„æ ¼ | å®ç° | ç»“æœ |
|--------|------|------|------|
| å¿…å¡«å­—æ®µ | email: required | email: æ— éªŒè¯ | âš ï¸ ç¼ºå°‘éªŒè¯ |
| å­—æ®µç±»å‹ | age: number | age: string | âŒ ç±»å‹ä¸åŒ¹é… |
| å­—æ®µç¼ºå¤± | name: optional | æ—  name å­—æ®µ | âš ï¸ å­—æ®µç¼ºå¤± |

### 4. å“åº”æ ¼å¼ä¸€è‡´æ€§

**è§„åˆ™**ï¼šå“åº”ç»“æ„ä¸è§„æ ¼åŒ¹é…

**æ£€æŸ¥ç‚¹**ï¼š
- å“åº”å­—æ®µå®Œæ•´
- å­—æ®µç±»å‹æ­£ç¡®
- åµŒå¥—ç»“æ„åŒ¹é…

### 5. çŠ¶æ€ç ä¸€è‡´æ€§

**è§„åˆ™**ï¼šHTTP çŠ¶æ€ç ä¸è§„æ ¼ä¸€è‡´

| åœºæ™¯ | è§„æ ¼ | å®ç° | ç»“æœ |
|------|------|------|------|
| åˆ›å»ºæˆåŠŸ | 201 | 200 | âš ï¸ åº”ä½¿ç”¨ 201 |
| èµ„æºä¸å­˜åœ¨ | 404 | 500 | âŒ çŠ¶æ€ç é”™è¯¯ |

### 6. é”™è¯¯ç ä¸€è‡´æ€§

**è§„åˆ™**ï¼šä¸šåŠ¡é”™è¯¯ç ä¸è§„æ ¼ä¸€è‡´

**æ£€æŸ¥ç‚¹**ï¼š
- é”™è¯¯ç æšä¸¾å€¼åŒ¹é…
- é”™è¯¯æ¶ˆæ¯æ ¼å¼ä¸€è‡´
- é”™è¯¯å“åº”ç»“æ„ä¸€è‡´

---

## æ£€æŸ¥æ‰§è¡Œ

### æ­¥éª¤ 1ï¼šæ”¶é›† API è§„æ ¼

```bash
# è¯»å– API è§„æ ¼æ–‡æ¡£
cat .proposal/{feature}/3-api-spec.md
```

### æ­¥éª¤ 2ï¼šæ‰«æå®ç°ä»£ç 

```bash
# Java
find src -name "*Controller.java" -exec cat {} \;

# TypeScript
find src -name "*.controller.ts" -exec cat {} \;
```

### æ­¥éª¤ 3ï¼šæ„å»ºå¯¹æ¯”çŸ©é˜µ

```
Spec API           | Impl API           | Status
-------------------|--------------------|---------
POST /api/users    | POST /api/users    | âœ…
GET /api/users/{id}| GET /api/users/:id | âœ…
PUT /api/users/{id}| æœªå®ç°              | âŒ
```

### æ­¥éª¤ 4ï¼šæ·±åº¦æ£€æŸ¥

å¯¹æ¯ä¸ªåŒ¹é…çš„ API è¿›è¡Œè¯¦ç»†æ£€æŸ¥ï¼š
- è¯·æ±‚å‚æ•°
- å“åº”æ ¼å¼
- é”™è¯¯å¤„ç†

---

## é—®é¢˜ä¸¥é‡ç¨‹åº¦

| çº§åˆ« | æè¿° | ç¤ºä¾‹ |
|------|------|------|
| ğŸ”´ ERROR | ç¼ºå°‘è§„æ ¼å®šä¹‰çš„ API | PUT /api/users æœªå®ç° |
| ğŸ”´ ERROR | è¯·æ±‚å‚æ•°ä¸å…¼å®¹ | å¿…å¡«å­—æ®µç¼ºå¤± |
| ğŸŸ¡ WARNING | å“åº”æ ¼å¼å·®å¼‚ | å­—æ®µç±»å‹ä¸åŒ |
| ğŸŸ¡ WARNING | çŠ¶æ€ç ä¸è§„èŒƒ | ç”¨ 200 ä»£æ›¿ 201 |
| ğŸ”µ INFO | å®ç°äº†è§„æ ¼å¤–çš„ API | é¢å¤–çš„ GET /api/health |

---

## è¾“å‡ºæ ¼å¼

### é€šè¿‡

```
ğŸ”Œ API ä¸€è‡´æ€§æ£€æŸ¥
â”œâ”€â”€ è§„æ ¼å®šä¹‰: 5 ä¸ªæ¥å£
â”œâ”€â”€ å·²å®ç°: 5 ä¸ªæ¥å£
â”œâ”€â”€ ä¸€è‡´: 5 ä¸ª
â”œâ”€â”€ å·®å¼‚: 0 ä¸ª
â””â”€â”€ çŠ¶æ€: âœ… é€šè¿‡
```

### æœ‰å·®å¼‚

```
ğŸ”Œ API ä¸€è‡´æ€§æ£€æŸ¥
â”œâ”€â”€ è§„æ ¼å®šä¹‰: 5 ä¸ªæ¥å£
â”œâ”€â”€ å·²å®ç°: 4 ä¸ªæ¥å£
â”œâ”€â”€ ä¸€è‡´: 3 ä¸ª
â”œâ”€â”€ å·®å¼‚: 2 ä¸ª
â”‚   â”œâ”€â”€ [ERROR] PUT /api/users/{id} - æœªå®ç°
â”‚   â”œâ”€â”€ [WARN] POST /api/users - å“åº”çŠ¶æ€ç åº”ä¸º 201
â”‚   â””â”€â”€ [INFO] GET /api/health - è§„æ ¼å¤–æ¥å£
â””â”€â”€ çŠ¶æ€: âŒ å¤±è´¥
```

---

## å·®å¼‚è¯¦æƒ…æŠ¥å‘Š

å½“å‘ç°å·®å¼‚æ—¶ï¼Œç”Ÿæˆè¯¦ç»†æŠ¥å‘Šï¼š

```
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
API å·®å¼‚è¯¦æƒ…ï¼šPOST /api/users
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ã€è¯·æ±‚å‚æ•°ã€‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å­—æ®µ     â”‚ è§„æ ¼       â”‚ å®ç°       â”‚ çŠ¶æ€   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ email    â”‚ string, å¿… â”‚ string, å¿… â”‚ âœ…     â”‚
â”‚ password â”‚ string, å¿… â”‚ string, å¯ â”‚ âš ï¸     â”‚
â”‚ name     â”‚ string, å¯ â”‚ ç¼ºå¤±       â”‚ âš ï¸     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€å“åº”æ ¼å¼ã€‘
è§„æ ¼ï¼š
  {
    "id": number,
    "email": string,
    "name": string
  }

å®ç°ï¼š
  {
    "id": number,
    "email": string,
    "username": string  // å­—æ®µåä¸åŒ
  }

å·®å¼‚ï¼šå­—æ®µå name vs username

ã€å»ºè®®ä¿®å¤ã€‘
1. UserController.java:42 - å°† password å‚æ•°è®¾ä¸ºå¿…å¡«
2. UserDTO.java:15 - å°† username æ”¹ä¸º name
```

---

## å¸¸è§å·®å¼‚åœºæ™¯

### åœºæ™¯ 1ï¼šå­—æ®µå‘½åä¸ä¸€è‡´

```
è§„æ ¼: userName
å®ç°: username / user_name
```

å»ºè®®ï¼šç»Ÿä¸€ä½¿ç”¨è§„æ ¼ä¸­çš„å‘½åã€‚

### åœºæ™¯ 2ï¼šç±»å‹ä¸ç²¾ç¡®

```
è§„æ ¼: integer
å®ç°: number / long / int
```

å»ºè®®ï¼šæ£€æŸ¥è¾¹ç•Œå€¼æ˜¯å¦åŒ¹é…ã€‚

### åœºæ™¯ 3ï¼šå¯é€‰å­—æ®µå¤„ç†

```
è§„æ ¼: age (å¯é€‰)
å®ç°: æ—  age å­—æ®µ
```

å»ºè®®ï¼šæ·»åŠ å­—æ®µä½†å…è®¸ä¸º nullã€‚

### åœºæ™¯ 4ï¼šé”™è¯¯ç é—æ¼

```
è§„æ ¼: INVALID_EMAIL, EMAIL_EXISTS
å®ç°: åªå¤„ç†äº† INVALID_EMAIL
```

å»ºè®®ï¼šè¡¥å……æ‰€æœ‰è§„æ ¼å®šä¹‰çš„é”™è¯¯ç å¤„ç†ã€‚
