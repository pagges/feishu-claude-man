# 场景审查报告

**输入文件夹**: {input_folder}
**审查时间**: YYYY-MM-DD HH:mm:ss
**审查结果**: ❌ 不通过 / ⚠️ 有警告 / ✅ 通过

---

## 检查汇总

| 检查项 | 状态 | 详情 |
|--------|------|------|
| 流程覆盖 | ✅/⚠️/❌ | 覆盖率 XX% |
| 步骤完整 | ✅/⚠️/❌ | X 个缺失/格式错误 |
| 步骤结构 | ✅/⚠️/❌ | X 个结构偏离 |
| 变量引用 | ✅/⚠️/❌ | X 个引用错误 |
| 步骤数量 | ✅/⚠️/❌ | X 个数量不一致 |
| 断言匹配 | ✅/⚠️/❌ | X 个断言不匹配 |

---

## 🔴 必须修复 (X 个)

| 编号 | 类型 | 问题描述 | 场景/步骤 |
|------|------|----------|-----------|
| E-1 | 步骤 | Sheet2 无步骤详情 | 场景 #2 |
| E-2 | 格式 | assertions JSON 格式错误 | 场景 #5 步骤 2 |
| E-3 | 逻辑 | test_steps 描述 3 步，实际 2 步 | 场景 #8 |

---

## 🟡 建议修复 (X 个)

| 编号 | 类型 | 问题描述 | 场景/步骤 |
|------|------|----------|-----------|
| W-1 | 变量 | 变量 orderId 未被使用 | 场景 #3 步骤 1 |
| W-2 | 结构 | 步骤数量与模板不一致（2 vs 4） | 场景 #4 |
| W-3 | 断言 | expected "返回订单号" 未在断言中体现 | 场景 #6 |

---

## 🔵 参考信息 (X 个)

| 编号 | 类型 | 描述 |
|------|------|------|
| I-1 | 需求 | 业务流程「退款流程」未被场景覆盖 |
| I-2 | 需求 | 业务流程「取消订单」未被场景覆盖 |

---

## 修复建议

### E-1: Sheet2 无步骤详情

- **场景**: #2 - {scenario_name}
- **问题**: 场景状态为"待导入"但 Sheet2 中无对应步骤
- **建议修复**: 在 Sheet2 中添加场景步骤详情，或将状态改回"待实现"

### E-2: assertions JSON 格式错误

- **场景**: #5 - {scenario_name}
- **步骤**: 步骤 2 - {step_name}
- **问题**: JSON 解析失败
- **当前值**: `[{"expression": "$.statusCode", expect: "100"}]`
- **错误**: 缺少引号包裹 `expect` 键名
- **建议修复**:
  ```json
  [{"expression": "$.statusCode", "expect": "100", "option": "EQUALS"}]
  ```

### E-3: test_steps 与步骤数量不一致

- **场景**: #8 - {scenario_name}
- **问题**: test_steps 描述 3 步操作，但 Sheet2 只有 2 步
- **test_steps**: "1. 创建订单 2. 支付订单 3. 查询订单状态"
- **实际步骤**: 步骤 1: 创建订单, 步骤 2: 支付订单
- **建议修复**:
  - 添加步骤 3: 查询订单状态
  - 或修改 test_steps 描述

---

## 场景详情

### 待审查场景列表

| 编号 | scenario_id | name | 步骤数 | 问题数 |
|------|-------------|------|--------|--------|
| #1 | S001 | 完整下单流程 | 4 | 0 |
| #2 | S002 | 简化下单流程 | 0 | 1 (E-1) |
| #3 | S003 | 带变量传递的流程 | 3 | 1 (W-1) |
| ... | ... | ... | ... | ... |

### 步骤详情（有问题的场景）

#### 场景 #5: {scenario_name}

| 步骤 | api_uuid | step_name | 问题 |
|------|----------|-----------|------|
| 1 | uuid-1 | 创建订单 | - |
| 2 | uuid-2 | 支付订单 | E-2: assertions 格式错误 |
| 3 | uuid-3 | 查询状态 | - |

---

## 变量追踪

### 场景 #3 变量使用情况

| 变量名 | 定义步骤 | 使用步骤 | 状态 |
|--------|----------|----------|------|
| orderId | 步骤 1 | - | ⚠️ 未使用 |
| token | 步骤 1 | 步骤 2, 3 | ✅ 正常 |

---

## 下一步

根据审查结果，建议执行以下操作：

1. **修复 ERROR 级别问题**（必须）
   - 补充缺失的步骤详情
   - 修复 JSON 格式错误
   - 调整步骤数量使其与描述一致

2. **考虑修复 WARNING 级别问题**（建议）
   - 移除未使用的变量
   - 补充缺失的断言

3. **完成后重新运行** `/sbux:scenario-review` 验证

4. **审查通过后运行** `/sbux:scenario-import` 导入场景
